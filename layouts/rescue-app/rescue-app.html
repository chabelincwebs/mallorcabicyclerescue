<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="robots" content="noindex, nofollow">
  <title>{{ .Title }} | {{ .Site.Title }}</title>

  <!-- PWA Meta Tags -->
  <meta name="application-name" content="Mallorca Bicycle Rescue">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MBR Rescue">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#f00000">

  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">

  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/img/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/img/icon-512.png">
  <link rel="apple-touch-icon" href="/img/icon-192.png">

  <!-- Rescue App CSS -->
  <link rel="stylesheet" href="/css/rescue-app.css">
</head>
<body>
  <div id="rescue-app" class="rescue-container">
    <!-- Language Selector -->
    <div class="language-selector">
      <button data-lang="en" class="{{ if eq .Site.Language.Lang "en" }}active{{ end }}">EN</button>
      <button data-lang="de" class="{{ if eq .Site.Language.Lang "de" }}active{{ end }}">DE</button>
      <button data-lang="es" class="{{ if eq .Site.Language.Lang "es" }}active{{ end }}">ES</button>
    </div>

    <!-- Header -->
    <header class="rescue-header">
      <img src="/img/logo.svg" alt="Mallorca Bicycle Rescue" class="rescue-logo">
      <h1 id="app-title">{{ i18n "rescue_title" }}</h1>
    </header>

    <!-- GPS Status -->
    <div id="gps-status" class="gps-status">
      <div class="gps-loading" id="gps-loading">
        <div class="spinner"></div>
        <span id="gps-loading-text">{{ i18n "rescue_gps_loading" }}</span>
      </div>
      <div class="gps-success" id="gps-success" style="display:none;">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path d="M10 0C4.477 0 0 4.477 0 10s4.477 10 10 10 10-4.477 10-10S15.523 0 10 0zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8zm4.293-10.293L9 13l-3.293-3.293 1.414-1.414L9 10.172l3.879-3.879 1.414 1.414z"/>
        </svg>
        <span id="gps-accuracy"></span>
      </div>
      <div class="gps-error" id="gps-error" style="display:none;">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <path d="M10 0C4.477 0 0 4.477 0 10s4.477 10 10 10 10-4.477 10-10S15.523 0 10 0zm1 15H9v-2h2v2zm0-4H9V5h2v6z"/>
        </svg>
        <span id="gps-error-text"></span>
      </div>
    </div>

    <!-- Rescue Form -->
    <form id="rescue-form" class="rescue-form">
      <div class="form-group">
        <label for="name">{{ i18n "rescue_name" }} <span class="required">*</span></label>
        <input type="text" id="name" name="name" required autocomplete="name">
      </div>

      <div class="form-group">
        <label for="phone">{{ i18n "rescue_phone" }} <span class="required">*</span></label>
        <input type="tel" id="phone" name="phone" required autocomplete="tel">
      </div>

      <div class="form-group">
        <label for="group-size">{{ i18n "rescue_group_size" }} <span class="required">*</span></label>
        <input type="number" id="group-size" name="group-size" min="1" max="20" value="1" required>
      </div>

      <div class="form-group">
        <label for="bike-type">{{ i18n "rescue_bike_type" }} <span class="required">*</span></label>
        <select id="bike-type" name="bike-type" required>
          <option value="">{{ i18n "rescue_select_bike" }}</option>
          <option value="road">{{ i18n "rescue_bike_road" }}</option>
          <option value="mountain">{{ i18n "rescue_bike_mountain" }}</option>
          <option value="gravel">{{ i18n "rescue_bike_gravel" }}</option>
          <option value="ebike">{{ i18n "rescue_bike_ebike" }}</option>
          <option value="other">{{ i18n "rescue_bike_other" }}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="notes">{{ i18n "rescue_notes" }}</label>
        <textarea id="notes" name="notes" rows="4" placeholder="{{ i18n "rescue_notes_placeholder" }}"></textarea>
      </div>

      <!-- GDPR Consent -->
      <div class="form-group consent-group">
        <label class="consent-label">
          <input type="checkbox" id="gdpr-consent" name="gdpr-consent" required>
          <span>{{ i18n "rescue_gdpr_consent" }}</span>
        </label>
        <p class="consent-info">{{ i18n "rescue_gdpr_info" }}</p>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button type="button" id="whatsapp-btn" class="btn btn-whatsapp" disabled>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
          </svg>
          <span>{{ i18n "rescue_send_whatsapp" }}</span>
        </button>

        <button type="button" id="sms-btn" class="btn btn-sms" disabled>
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
          </svg>
          <span>{{ i18n "rescue_send_sms" }}</span>
        </button>
      </div>
    </form>

    <!-- Install Prompt -->
    <div id="install-prompt" class="install-prompt" style="display:none;">
      <p>{{ i18n "rescue_install_prompt" }}</p>
      <button id="install-btn" class="btn btn-install">{{ i18n "rescue_install_app" }}</button>
      <button id="dismiss-install" class="btn-link">{{ i18n "rescue_dismiss" }}</button>
    </div>
  </div>

  <!-- Rescue App JavaScript -->
  <script>
    // Pass Hugo i18n data to JavaScript
    window.rescueI18n = {
      lang: "{{ .Site.Language.Lang }}",
      translations: {
        gps_loading: {{ i18n "rescue_gps_loading" | jsonify }},
        gps_accuracy: {{ i18n "rescue_gps_accuracy" | jsonify }},
        gps_error_denied: {{ i18n "rescue_gps_error_denied" | jsonify }},
        gps_error_unavailable: {{ i18n "rescue_gps_error_unavailable" | jsonify }},
        gps_error_timeout: {{ i18n "rescue_gps_error_timeout" | jsonify }},
        gps_error_unknown: {{ i18n "rescue_gps_error_unknown" | jsonify }},
        form_validation: {{ i18n "rescue_form_validation" | jsonify }},
        message_sent: {{ i18n "rescue_message_sent" | jsonify }},
        emergency_heading: {{ i18n "rescue_emergency_heading" | jsonify }},
        location_label: {{ i18n "rescue_location_label" | jsonify }},
        name_label: {{ i18n "rescue_name_label" | jsonify }},
        phone_label: {{ i18n "rescue_phone_label" | jsonify }},
        group_label: {{ i18n "rescue_group_label" | jsonify }},
        bike_label: {{ i18n "rescue_bike_label" | jsonify }},
        notes_label: {{ i18n "rescue_notes_label" | jsonify }}
      }
    };
  </script>
  <script src="/js/rescue-app.js"></script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('Service Worker registered'))
          .catch(err => console.log('Service Worker registration failed:', err));
      });
    }
  </script>
</body>
</html>
